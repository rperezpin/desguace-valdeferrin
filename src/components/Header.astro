---
import { site } from '../data/site';

const currentPath = Astro.url.pathname;
---

<header
  id="site-header"
  class="fixed top-0 left-0 right-0 z-50 bg-white/90 backdrop-blur-md border-b border-grey-200 transition-shadow duration-300"
>
  <div class="container-site flex items-center justify-between h-20 lg:h-24">
    <!-- Logo -->
    <a href="/" class="flex items-center gap-3 shrink-0">
      <img
        src="/images/logo_96.png"
        alt={`${site.name} - Logo`}
        width="48"
        height="48"
        class="w-10 h-10 lg:w-12 lg:h-12 rounded-full"
      />
      <div class="hidden sm:block">
        <span class="font-display font-bold text-primary-700 text-lg uppercase leading-tight block">
          Desguaces Valdeferrin
        </span>
        <span class="text-xs text-grey-600 leading-tight block">
          Tu desguace de confianza
        </span>
      </div>
    </a>

    <!-- Desktop Nav -->
    <nav class="hidden lg:flex items-center gap-2">
      {site.nav.map((item) => (
        <a
          href={item.href}
          class:list={[
            'px-3 py-2 text-sm font-medium rounded-md transition-colors duration-200',
            currentPath === item.href
              ? 'text-primary-700 bg-primary-50'
              : 'text-grey-700 hover:text-primary-700 hover:bg-primary-50',
          ]}
        >
          {item.label}
        </a>
      ))}
    </nav>

    <!-- Right: Phone + CTA + Hamburger -->
    <div class="flex items-center gap-4 lg:gap-5">
      <!-- Phone (desktop) -->
      <a
        href={site.phoneHref}
        class="hidden md:flex items-center gap-2 text-primary-700 font-display font-bold text-sm hover:text-accent-500 transition-colors"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
        {site.phone}
      </a>

      <!-- Phone icon (mobile) -->
      <a
        href={site.phoneHref}
        class="md:hidden flex items-center justify-center w-10 h-10 text-primary-700 hover:text-accent-500 transition-colors"
        aria-label="Llamar por telefono"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
      </a>

      <!-- Acceder button (desktop) -->
      <div class="hidden lg:block">
        <a href="/acceder" class="btn-secondary" style="padding: 0.5rem 1.25rem; font-size: 0.75rem;">
          Acceder
        </a>
      </div>

      <!-- Hamburger (mobile) -->
      <button
        id="menu-toggle"
        class="lg:hidden flex items-center justify-center w-10 h-10 text-dark hover:text-primary-700 transition-colors"
        aria-label="Abrir menu"
        aria-expanded="false"
      >
        <svg id="menu-icon-open" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        <svg id="menu-icon-close" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <nav
    id="mobile-menu"
    class="lg:hidden hidden bg-white border-t border-grey-200 shadow-lg"
  >
    <div class="container-site py-4 flex flex-col gap-1">
      {site.nav.map((item) => (
        <a
          href={item.href}
          class:list={[
            'px-4 py-3 text-sm font-medium rounded-md transition-colors',
            currentPath === item.href
              ? 'text-primary-700 bg-primary-50'
              : 'text-grey-700 hover:text-primary-700 hover:bg-primary-50',
          ]}
        >
          {item.label}
        </a>
      ))}
      <hr class="border-grey-200 my-2" />
      <a href="/acceder" class="btn-secondary" style="width: 100%; font-size: 0.75rem;">
        Acceder
      </a>
    </div>
  </nav>
</header>

<!-- Spacer for fixed header -->
<div class="h-20 lg:h-24"></div>

<script>
  const toggle = document.getElementById('menu-toggle');
  const menu = document.getElementById('mobile-menu');
  const iconOpen = document.getElementById('menu-icon-open');
  const iconClose = document.getElementById('menu-icon-close');

  toggle?.addEventListener('click', () => {
    const isOpen = !menu?.classList.contains('hidden');
    menu?.classList.toggle('hidden');
    iconOpen?.classList.toggle('hidden');
    iconClose?.classList.toggle('hidden');
    toggle.setAttribute('aria-expanded', String(!isOpen));
  });

  // Shadow on scroll
  let lastScroll = 0;
  window.addEventListener('scroll', () => {
    const header = document.getElementById('site-header');
    if (window.scrollY > 10) {
      header?.classList.add('shadow-md');
    } else {
      header?.classList.remove('shadow-md');
    }
    lastScroll = window.scrollY;
  });
</script>
